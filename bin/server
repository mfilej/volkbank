#!/usr/bin/env jruby

require 'logger'

$LOAD_PATH.unshift File.join(File.dirname(__FILE__), '..', 'lib')
require 'volkbank'

port = ARGV.first.to_i
listener = Listener.new(port)
logger = Logger.new(STDOUT)
logger.level = Logger::DEBUG

puts "Listening on #{port}..."

begin
  loop do
    server = listener.listen
    logger.info "#{server.dispatch} from #{server.socket.remote_socket_address}"
  end
rescue StandardError => ex
  logger.error ex.to_s
  puts ex.backtrace.join("\n")
end