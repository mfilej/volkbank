#!/usr/bin/env jruby

require 'logger'

$LOAD_PATH.unshift File.join(File.dirname(__FILE__), '..', 'lib')
require 'volkbank'

port = ARGV.shift.to_i
options = {
  :key => {
    :store => ARGV.shift,
    :pass => ARGV.shift
  },
  :trust => {
    :store => ARGV.shift,
    :pass => ARGV.shift
  }
}

listener = Listener.new(port, options)

logger = Logger.new(STDOUT)
logger.level = Logger::DEBUG

puts "Listening on #{port}..."

begin
  loop do
    server = listener.listen
    logger.info "#{server.dispatch} from #{server.socket.remote_socket_address}"
  end
rescue StandardError => ex
  logger.error ex.to_s
  puts ex.backtrace.join("\n")
end